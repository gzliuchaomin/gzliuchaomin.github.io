<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>mac superset 本地构建全记录 | 炒面馆子</title>
<meta name="description" content="本店只有炒面，出门左转有美食街">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://gzliuchaomin.github.io/favicon.ico?v=1621432804780">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://gzliuchaomin.github.io/styles/main.css">


<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://gzliuchaomin.github.io">炒面馆子</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                作品
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/xie-zuo/" class="menu">
                写作
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>mac superset 本地构建全记录</h1>
            <p class="article-meta">
              2021-05-18
              
            </p>
            
            <div class="post-content">
              <p>官网上有很多的指引，包括 docker 及多种工具的使用和安装</p>
<blockquote>
<p>https://superset.apache.org/docs/installation/installing-superset-using-docker-compose</p>
</blockquote>
<p>这里，笔者想在本地构建开发环境，打算长期跟进这一个开源项目。尝试了官网的多个指引之后，发现有多个问题，后找到了 github 上的指引</p>
<blockquote>
<p>https://github.com/apache/superset/blob/master/CONTRIBUTING.md#os-dependencies</p>
</blockquote>
<h2 id="一-下拉-github-代码">一、下拉 github 代码</h2>
<h2 id="二-首先需要将本地的-python-指向-python3pip-升级使用-pip3">二、首先，需要将本地的 python 指向 python3，pip 升级使用 pip3</h2>
<h2 id="三-服务端根据指引进行过程可能会出现很多问题需要一个个地解决">三、服务端：根据指引进行，过程可能会出现很多问题，需要一个个地解决</h2>
<pre><code># Create a virtual environment and activate it (recommended)
python3 -m venv venv # setup a python3 virtualenv
source venv/bin/activate

# Install external dependencies
pip install -r requirements/local.txt

# Install Superset in editable (development) mode
pip install -e .

# Create an admin user in your metadata database
superset fab create-admin

# Initialize the database
superset db upgrade

# Create default roles and permissions
superset init

# Load some data to play with (you must create an Admin user with the username `admin` for this command to work)
superset load-examples

# Start the Flask dev web server from inside your virtualenv.
# Note that your page may not have css at this point.
# See instructions below how to build the front-end assets.
FLASK_ENV=development superset run -p 8088 --with-threads --reload --debugger

Or you can install via our Makefile

```bash
# Create a virtual environment and activate it (recommended)
$ python3 -m venv venv # setup a python3 virtualenv
$ source venv/bin/activate

# install pip packages + pre-commit
$ make install

# Install superset pip packages and setup env only
$ make superset

# Setup pre-commit only
$ make pre-commit
</code></pre>
<p>使用 virtualenv 来引入独立的包管理，<br>
其中， source venv/bin/activate 可以激活独立环境，退出使用 deactivate</p>
<h4 id="在执行-pip-install-r-requirementslocaltxt-过程中出现问题">在执行 pip install -r requirements/local.txt 过程中，出现问题：</h4>
<p>1、出现 pandas 版本要求在 1.2.2 版本，而镜像服务器中最高只有 1.1.5，<br>
所以，需要手动下载 https://github.com/pandas-dev/pandas/releases</p>
<p>在 ./superset/venv/lib/python3.7/site-packages 看到独立环境中的包，<br>
一般来说，一个包包含两个目录，一个是库文件目录，一个是包说明目录。</p>
<p>需要将 pandas 解压目录中的 pandas 和 pandas.egg-info （这个说明目录，最好按照版本重新命名） 复制到 ./superset/venv/lib/python3.7/site-packages 中。</p>
<p>其中，需要将 pandas.egg-info 中的 PKG-INFO 文件，复制出文件 METADATA。</p>
<p><em>另外，还为需要注意 pandas C 代码库的问题，后续会遇到</em></p>
<h4 id="执行-superset-fab-create-admin-出现的问题">执行 superset fab create-admin 出现的问题：</h4>
<p>1、安装 sasl 不成功</p>
<p>有类似的报错</p>
<pre><code>sh: line 1:  2207 Bus error: 10           /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk macosx -find clang 2&gt; /dev/null
    clang: error: unable to find utility &quot;clang&quot;, not a developer tool or in PATH
    error: command 'clang' failed with exit status 72
</code></pre>
<p>查看版本 clang -v，有信息</p>
<pre><code>You have not agreed to the Xcode license agreements. You must agree to both license agreements below in order to use Xcode.

Press the 'return' key to view the license agreements at '/Applications/Xcode.app/Contents/Resources/English.lproj/License.rtf'
</code></pre>
<p>执行 xcodebuild -license， 并空格移动到最后，agree 就好。</p>
<p>2、openssl 报错</p>
<pre><code>ImportError: dlopen(/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/lib-dynload/_ssl.cpython-37m-darwin.so, 2): Library not loaded: /usr/local/opt/openssl/lib/libssl.1.0.0.dylib
  Referenced from: /usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/lib/python3.7/lib-dynload/_ssl.cpython-37m-darwin.so
  Reason: image not found

ssl 报错
</code></pre>
<blockquote>
<p>参考 https://stackoverflow.com/questions/59006602/dyld-library-not-loaded-usr-local-opt-openssl-lib-libssl-1-0-0-dylib</p>
</blockquote>
<pre><code>brew install rbenv/tap/openssl@1.0 
ln -s /usr/local/Cellar/openssl@1.0/1.0.2t /usr/local/opt/openssl
</code></pre>
<p>3、pandas C 扩展库的问题</p>
<pre><code>ImportError: C extension: No module named 'pandas._libs.interval' not built. If you want to import pandas from the source directory, you may need to run 'python setup.py build_ext --force' to build the C extensions first.
</code></pre>
<p>刚开始，笔者在原先下载的pandas 1.2.2 的包里，</p>
<blockquote>
<p>python3 -m venv venv<br>
pip install numpy<br>
...</p>
</blockquote>
<p>还依赖其它包</p>
<pre><code>Package    Version
---------- -------
Cython     0.29.23
numpy      1.18.1 # 开始版本是1.20
pi         0.1.2
pip        21.1.1
setuptools 39.0.1
</code></pre>
<p>开始下载的numpy 是最新的1.20版本，运行 'python setup.py build_ext --force' ，生成新的库文件，并替换 superset 环境中的 panda 包的库文件。</p>
<p>但，再次运行 出错</p>
<pre><code>ValueError: numpy.ndarray size changed, may indicate binary incompatibility. Expected 88 from C header, got 80 from PyObject
</code></pre>
<p>参考链接有</p>
<blockquote>
<p>https://stackoverflow.com/questions/66060487/valueerror-numpy-ndarray-size-changed-may-indicate-binary-incompatibility-exp#answer-66743692</p>
</blockquote>
<p>基本意思是 运行时的 numpy 版本和 构建时的numpy版本不一致，特别是 版本 1.20 前后的代码有所区别。所以，笔者重新在下载解压panda包中，</p>
<blockquote>
<p>pip uninstall numpy  # 注意是在之前虚拟库环境中<br>
pip install numpy==1.18.1<br>
python setup.py build_ext --force # 再次构建</p>
</blockquote>
<p>重新构建出来的包，再次替换 superset 中的 panda 包。</p>
<p>重新运行 superset fab create-admin，成功，并创建用户密码。</p>
<p><em>另外，结合上面说法，可以查看 superset 下载的numpy包的版本，再下载相应的包进行 构建 panda 会更稳妥。</em></p>
<h4 id="superset-load-examples-的问题">superset load-examples 的问题</h4>
<p>1、</p>
<pre><code>...
ssl.SSLEOFError: EOF occurred in violation of protocol (_ssl.c:1045)
</code></pre>
<p>尝试重新安装 mac 的本地 postgresql，移动到公司网络就可以了</p>
<p>最后运行</p>
<blockquote>
<p>FLASK_ENV=development superset run -p 8088 --with-threads --reload --debugger</p>
</blockquote>
<p>能正常运行</p>
<h2 id="四-前端">四、前端</h2>
<pre><code>cd superset-frontend
nvm install --lts
nvm use --lts
npm install -g npm@7
npm ci
npm run dev-server
</code></pre>
<p>没有问题</p>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://gzliuchaomin.github.io/post/mac-shang-an-zhuang-parallels-16/">
                <h3 class="post-title">
                  Mac 上安装 Parallels 16
                </h3>
              </a>
            </div>
          
        </div>
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://gzliuchaomin.github.io/images/avatar.png?v=1621432804780" class="no-responsive avatar">
    <div class="text-muted">本店只有炒面，出门左转有美食街</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/mac-superset-ben-di-gou-jian-quan-ji-lu/">mac superset 本地构建全记录</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/mac-shang-an-zhuang-parallels-16/">Mac 上安装 Parallels 16</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/gridea-yu-github-pei-zhi-kuai-su-zhi-yin/">Gridea 与 github 配置快速指引</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/chu-xue-zhe-rust-tiao-jian-kong-zhi-if-else-if-matchzhi-yin/">[初学者] Rust条件控制(if, else if, match)指引</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/ji-de-li-yi-zhe-de-kuai-le/">既得利益者的快乐</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/shu-ju-fen-ye-de-luo-ji-he-fang-fa-yue-du-fen-xiang/">数据分页的逻辑和方法 - 阅读分享</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/ren-shi-sketch/">认识 Sketch</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/about/">关于</a>
            </li>
          
        
          
            <li>
              <a href="https://gzliuchaomin.github.io/post/about-blog/">关于博客</a>
            </li>
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://gzliuchaomin.github.io/tag/OiBr18-0c/" class="badge secondary">
          gridea
        </a>
      
        <a href="https://gzliuchaomin.github.io/tag/9stK7jJ3rB/" class="badge warning">
          github
        </a>
      
        <a href="https://gzliuchaomin.github.io/tag/nrnqd8awy/" class="badge success">
          电影
        </a>
      
        <a href="https://gzliuchaomin.github.io/tag/7cjluLzyx/" class="badge secondary">
          数据库
        </a>
      
        <a href="https://gzliuchaomin.github.io/tag/EnOflh3-Uv/" class="badge ">
          sketch
        </a>
      
        <a href="https://gzliuchaomin.github.io/tag/RY59Pa1IAi/" class="badge ">
          blog
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/gzliuchaomin" target="_blank">gzliuchaomin</a> | <a class="rss" href="https://gzliuchaomin.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>




  </body>
</html>
